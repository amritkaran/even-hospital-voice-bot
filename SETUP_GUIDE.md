# Even Hospital Voice Bot - Setup Guide

Complete step-by-step setup guide for the Even Hospital doctor booking voice bot.

## Quick Start (5 minutes)

### Step 1: Get Your API Keys

#### OpenAI API Key
1. Go to https://platform.openai.com/api-keys
2. Sign in or create account
3. Click "Create new secret key"
4. Copy the key (starts with `sk-`)
5. **Important**: You'll need ~$5 in credits

#### VAPI API Key
1. Go to https://vapi.ai
2. Sign up for account
3. Navigate to Settings â†’ API Keys
4. Copy your API key

### Step 2: Install Dependencies

```bash
cd "C:\Users\AD\Desktop\Even Hospital"
npm install
```

### Step 3: Configure API Keys

Edit `config/.env`:

```env
OPENAI_API_KEY=sk-your-actual-key-here
VAPI_API_KEY=your-vapi-key-here
```

### Step 4: Generate Embeddings

```bash
npm run generate-embeddings
```

**This will take 2-3 minutes and cost ~$0.10**

Expected output:
```
âœ“ RAG document loaded successfully
  - Total doctors: 28
  - Total specialties: 12
âœ“ Extracted 200+ embeddable chunks
âœ“ Embeddings saved to: ./data/embeddings/doctor_embeddings.json
```

### Step 5: Test RAG System

```bash
npm run test-rag
```

You should see doctor recommendations for test queries.

### Step 6: Start Server

```bash
npm start
```

Server will start on http://localhost:3000

### Step 7: Test API

Open another terminal and test:

```bash
curl -X POST http://localhost:3000/api/search-doctors ^
  -H "Content-Type: application/json" ^
  -d "{\"symptoms\": \"I have knee pain\"}"
```

You should get doctor recommendations!

## Detailed Setup

### Understanding the System

The voice bot has 4 main components:

1. **RAG Service**: Finds doctors based on symptoms using semantic search
2. **Embedding Service**: Generates OpenAI embeddings for search
3. **VAPI Service**: Handles voice conversations
4. **Appointment Service**: Manages bookings

### File Structure

```
Even Hospital/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ .env                    # Your API keys (YOU NEED TO EDIT THIS)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ embeddings/            # Generated by npm run generate-embeddings
â”‚   â”‚   â””â”€â”€ doctor_embeddings.json
â”‚   â””â”€â”€ appointments.json       # Created automatically on first booking
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ services/              # Core business logic
â”‚   â”œâ”€â”€ utils/                 # Helper utilities
â”‚   â””â”€â”€ index.js              # Main server
â””â”€â”€ package.json
```

### API Key Setup Details

#### Getting OpenAI API Key

**Option 1: Existing Account**
- Platform: https://platform.openai.com/api-keys
- Click "Create new secret key"
- Name it "Even Hospital Voice Bot"
- Copy and save immediately (shown only once)

**Option 2: New Account**
- Sign up at https://platform.openai.com
- Verify email
- Add payment method (Settings â†’ Billing)
- Add minimum $5 credit
- Go to API Keys and create key

**Costs:**
- Embedding generation (one-time): $0.05-0.10
- Per search query: $0.001
- Monthly for 1000 searches: ~$1-2

#### Getting VAPI API Key

1. Sign up at https://vapi.ai
2. Verify email
3. Complete onboarding
4. Dashboard â†’ Settings â†’ API Keys
5. Copy your API key

**VAPI Pricing:**
- Check current pricing at https://vapi.ai/pricing
- Usually has free tier for testing

### Configuration File

Edit `config/.env`:

```env
# ============================================
# OpenAI Configuration
# ============================================
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxx

# ============================================
# VAPI Configuration
# ============================================
VAPI_API_KEY=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
VAPI_ASSISTANT_ID=             # Leave empty, will be created
VAPI_PHONE_NUMBER_ID=          # Optional: for phone calls

# ============================================
# Server Configuration
# ============================================
PORT=3000
NODE_ENV=development

# ============================================
# Hospital Information
# ============================================
HOSPITAL_NAME="Even Hospital Bangalore"
HOSPITAL_LOCATION="29/2, Race Course Rd, Madhava Nagar, Gandhi Nagar, Bengaluru, Karnataka 560001"
HOSPITAL_PHONE="+91-XXX-XXX-XXXX"

# ============================================
# Data Paths (Use defaults)
# ============================================
RAG_DOCUMENT_PATH="C:\\Users\\AD\\Desktop\\Even Voice Bot\\even_hospital_comprehensive_rag_document.json"
EMBEDDINGS_PATH="./data/embeddings/doctor_embeddings.json"
```

### Testing Each Component

#### 1. Test Embedding Generation

```bash
npm run generate-embeddings
```

**Success indicators:**
- âœ“ RAG document loaded
- âœ“ Extracted chunks
- âœ“ Embeddings saved
- File created: `data/embeddings/doctor_embeddings.json` (should be ~5-10 MB)

**If it fails:**
- Check OpenAI API key is correct
- Verify you have credits in OpenAI account
- Ensure RAG document path is correct

#### 2. Test RAG Service

```bash
npm run test-rag
```

**Success indicators:**
- Shows doctor recommendations for test queries
- Relevance scores displayed
- Match reasons shown

**Test queries:**
- "I have severe stomach pain" â†’ Should recommend General Surgery doctors
- "My knee hurts" â†’ Should recommend Orthopedic doctors
- "I'm pregnant" â†’ Should recommend Gynecologists

#### 3. Test Server

```bash
npm start
```

**Success indicators:**
```
âœ“ RAG Service initialized
âœ“ VAPI Service initialized
âœ“ Appointment Service initialized
Server running on http://localhost:3000
```

#### 4. Test API Endpoints

**Health Check:**
```bash
curl http://localhost:3000/health
```

**Doctor Search:**
```bash
curl -X POST http://localhost:3000/api/search-doctors ^
  -H "Content-Type: application/json" ^
  -d "{\"symptoms\": \"knee pain\"}"
```

**Book Appointment:**
```bash
curl -X POST http://localhost:3000/api/appointments/book ^
  -H "Content-Type: application/json" ^
  -d "{\"doctor_name\": \"Dr. Harish Puranik\", \"patient_name\": \"Test Patient\", \"patient_phone\": \"+91-9876543210\", \"preferred_date\": \"2025-11-15\", \"preferred_time\": \"morning\"}"
```

### VAPI Integration

#### Setup Voice Assistant

1. **Start your server** (must be running)

2. **Create VAPI assistant:**
```bash
curl -X POST http://localhost:3000/api/vapi/setup-assistant
```

3. **Copy Assistant ID** from response and add to `.env`:
```env
VAPI_ASSISTANT_ID=your-assistant-id-here
```

#### Configure Webhook (For Production)

1. **Make server public** (for testing, use ngrok):
```bash
ngrok http 3000
```

2. **Copy ngrok URL** (e.g., https://abc123.ngrok.io)

3. **Update VAPI webhook:**
   - Go to VAPI dashboard
   - Select your assistant
   - Set webhook URL: `https://abc123.ngrok.io/api/vapi/webhook`

4. **Test voice call:**
   - Use VAPI dashboard to initiate test call
   - Or use phone number if configured

### Troubleshooting

#### Problem: "Cannot find module"

**Solution:**
```bash
npm install
```

#### Problem: "OpenAI API key not configured"

**Solution:**
- Check `.env` file exists in `config/` folder
- Verify API key format: starts with `sk-`
- No quotes around the key
- No spaces

#### Problem: "Embeddings file not found"

**Solution:**
```bash
npm run generate-embeddings
```

#### Problem: "Rate limit exceeded"

**Solution:**
- Wait a few seconds and retry
- Check OpenAI account has credits
- Verify you're not on free tier limits

#### Problem: "RAG document not found"

**Solution:**
- Verify path in `.env`: `RAG_DOCUMENT_PATH`
- Check file exists at: `C:\Users\AD\Desktop\Even Voice Bot\even_hospital_comprehensive_rag_document.json`
- Use absolute path with double backslashes

#### Problem: "Port already in use"

**Solution:**
```bash
# Change PORT in .env
PORT=3001
```

Or kill process on port 3000:
```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <process_id> /F
```

#### Problem: VAPI webhook not working

**Solutions:**
1. **Check server is public:**
   - Use ngrok or deploy to cloud
   - Local servers won't work

2. **Verify webhook URL:**
   - Must be HTTPS
   - Must end with `/api/vapi/webhook`

3. **Check logs:**
   - Server console should show webhook requests

### Next Steps After Setup

1. **Test voice conversations:**
   - Use VAPI dashboard to test
   - Try different symptoms
   - Complete full booking flow

2. **Customize prompts:**
   - Edit system prompt in `src/services/vapiService.js`
   - Adjust conversation style
   - Add hospital-specific information

3. **Add features:**
   - SMS notifications
   - Email confirmations
   - Payment integration
   - Patient portal

4. **Deploy to production:**
   - Use cloud hosting (AWS, Heroku, DigitalOcean)
   - Set up proper database (PostgreSQL)
   - Configure monitoring
   - Set up backups

### Support Resources

- **OpenAI Docs**: https://platform.openai.com/docs
- **VAPI Docs**: https://docs.vapi.ai
- **Node.js Docs**: https://nodejs.org/docs
- **Express Docs**: https://expressjs.com

### Common Commands Reference

```bash
# Install dependencies
npm install

# Generate embeddings (one-time)
npm run generate-embeddings

# Test RAG system
npm run test-rag

# Start server
npm start

# Start in development mode (auto-reload)
npm run dev

# Check for errors
npm run lint   # (if configured)
```

### Verification Checklist

- [ ] Node.js 18+ installed
- [ ] OpenAI API key obtained and configured
- [ ] VAPI API key obtained and configured
- [ ] Dependencies installed (`npm install`)
- [ ] Embeddings generated (`npm run generate-embeddings`)
- [ ] RAG test passed (`npm run test-rag`)
- [ ] Server starts successfully (`npm start`)
- [ ] API endpoints respond (test with curl)
- [ ] VAPI assistant created
- [ ] Webhook configured (if using VAPI calls)

Once all items are checked, you're ready to go! ðŸš€
